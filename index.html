<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Firebase 연결 진단</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#111;color:#eee;margin:0}
    .wrap{max-width:900px;margin:24px auto;padding:0 16px}
    .panel{padding:16px;border:1px solid #444;border-radius:8px}
    .ok{color:#68d391}.fail{color:#fc8181}
  </style>
  <!-- compat 빌드: window.firebase 제공 -->
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="wrap">
  <h1>Firebase 연결 진단</h1>
  <div id="status" class="panel">준비중…</div>
</div>

<script>
  // Firebase 콘솔 > 웹앱 SDK 스니펫에 나온 값 그대로 사용 (중요)
  const firebaseConfig = {
    apiKey: "AIzaSyDcYL4IDbjuximgMUI7_XNElrqpkyV9YqLs",
    authDomain: "sarangbang-24dc2.firebaseapp.com",
    projectId: "sarangbang-24dc2",
    storageBucket: "sarangbang-24dc2.appspot.com",
    messagingSenderId: "122641770390",
    appId: "1:122641770390:web:df216317453f457f229fb7",
    measurementId: "G-P2TRBDXBW8"
  };

  const statusBox = document.getElementById("status");

  function log(html){ statusBox.innerHTML += html; }

  async function run() {
    try {
      // 1) 초기화
      firebase.initializeApp(firebaseConfig);
      statusBox.innerHTML = "<p class='ok'>✔ Firebase 초기화 성공</p>";

      // 2) 익명 로그인
      await firebase.auth().signInAnonymously();
      log("<p class='ok'>✔ 익명 로그인 성공</p>");

      // 3) Firestore 쓰기/읽기
      const db = firebase.firestore();
      const ref = db.collection("artifacts").doc("default-app-id")
                    .collection("public").doc("test_doc");
      await ref.set({ ping:"pong", at:new Date(), by:"github-pages" }, { merge:true });
      log("<p class='ok'>✔ Firestore 쓰기 성공</p>");
      const snap = await ref.get();
      log(snap.exists
        ? "<p class='ok'>✔ Firestore 읽기 성공: "+JSON.stringify(snap.data())+"</p>"
        : "<p class='fail'>✘ Firestore 문서 읽기 실패</p>");
    } catch (e) {
      log("<p class='fail'>✘ 오류 발생: "+ e.message +"</p>");
      console.error(e);
    }
  }

  run();
</script>
</body>
</html>
